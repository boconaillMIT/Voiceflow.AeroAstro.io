<!DOCTYPE html>
<html>
<head>
    <title>Voiceflow Simple Tester</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f5f5f5; 
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
        }
        .controls { 
            margin-bottom: 20px; 
            padding: 15px; 
            background: #e8f4f8; 
            border-radius: 5px; 
        }
        button { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 5px; 
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        #log { 
            height: 200px; 
            overflow-y: auto; 
            background: #f8f9fa; 
            border: 1px solid #ddd; 
            padding: 10px; 
            font-family: monospace; 
            font-size: 12px; 
            white-space: pre-wrap; 
        }
        .questions { 
            margin: 15px 0; 
            padding: 10px; 
            background: #fff3cd; 
            border-radius: 4px; 
        }
        .status { 
            font-weight: bold; 
            margin: 10px 0; 
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ Voiceflow Simple Tester</h1>
        
        <div class="controls">
            <button onclick="loadChatbot()">1. Load Chatbot</button>
            <button onclick="testSelectors()" id="testBtn" disabled>2. Test Selectors</button>
            <button onclick="startTesting()" id="startBtn" disabled>3. Start Auto-Testing</button>
            <button onclick="stopTesting()" id="stopBtn" disabled>Stop</button>
            <button onclick="clearLog()">Clear Log</button>
        </div>

        <div class="questions">
            <h3>Test Questions:</h3>
            <div id="questionsList">Loading questions...</div>
        </div>

        <div class="status" id="status">Ready to load chatbot</div>
        
        <div id="log"></div>

        <iframe id="chatFrame" style="width: 100%; height: 500px; border: 1px solid #ccc; margin-top: 20px;"></iframe>
    </div>

    <script>
        // Test questions - you can modify these
        const questions = [
            "What are the admission requirements?",
            "How do I apply for financial aid?",
            "What research opportunities are available?",
            "Who should I contact about course registration?",
            "What courses are required for the aerospace engineering degree?",
            "What is the application deadline?",
            "How do I schedule a campus visit?",
            "What scholarships are available?",
            "Tell me about the faculty research areas",
            "What are the prerequisites for graduate programs?"
        ];

        let currentQuestionIndex = 0;
        let testingInterval = null;
        let chatLoaded = false;

        // Display questions
        document.getElementById('questionsList').innerHTML = 
            questions.map((q, i) => `${i + 1}. ${q}`).join('<br>');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('log');
            const color = type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : type === 'warning' ? '#ffc107' : '#333';
            logDiv.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span>\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function loadChatbot() {
            const iframe = document.getElementById('chatFrame');
            iframe.src = 'https://aeroastrovfbot.netlify.app/chatbot.html';
            
            log('Loading chatbot...', 'info');
            updateStatus('Loading chatbot...', 'warning');
            
            iframe.onload = function() {
                log('Chatbot loaded successfully!', 'success');
                updateStatus('Chatbot loaded! Now test selectors.', 'success');
                document.getElementById('testBtn').disabled = false;
                chatLoaded = true;
                
                // Wait a bit for Voiceflow to initialize
                setTimeout(() => {
                    log('Voiceflow should be initialized now', 'info');
                }, 5000);
            };
        }

        function testSelectors() {
            if (!chatLoaded) {
                log('Please load chatbot first!', 'error');
                return;
            }

            const iframe = document.getElementById('chatFrame');
            
            try {
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                // Test for textarea
                const textarea = iframeDoc.querySelector('textarea.vfrc-chat-input');
                const sendButton = iframeDoc.querySelector('#vfrc-send-message');
                
                log('Testing selectors...', 'info');
                
                if (textarea) {
                    log('‚úÖ Found textarea: textarea.vfrc-chat-input', 'success');
                } else {
                    log('‚ùå Could not find textarea.vfrc-chat-input', 'error');
                    // Try alternative selectors
                    const altTextarea = iframeDoc.querySelector('textarea');
                    if (altTextarea) {
                        log(`üìù Found alternative textarea: ${altTextarea.className}`, 'warning');
                    }
                }
                
                if (sendButton) {
                    log('‚úÖ Found send button: #vfrc-send-message', 'success');
                } else {
                    log('‚ùå Could not find send button #vfrc-send-message', 'error');
                    // Try alternative selectors
                    const altButton = iframeDoc.querySelector('button[title="Send"]');
                    if (altButton) {
                        log(`üìù Found alternative send button: ${altButton.id || altButton.className}`, 'warning');
                    }
                }
                
                if (textarea && sendButton) {
                    updateStatus('Selectors found! Ready to start testing.', 'success');
                    document.getElementById('startBtn').disabled = false;
                    
                    // Test sending a message
                    log('Testing message send...', 'info');
                    textarea.value = 'Test message from automation';
                    textarea.dispatchEvent(new Event('input', { bubbles: true }));
                    
                    setTimeout(() => {
                        sendButton.click();
                        log('Test message sent!', 'success');
                    }, 1000);
                    
                } else {
                    updateStatus('Selectors not found. Check the log.', 'error');
                }
                
            } catch (error) {
                log(`Error testing selectors: ${error.message}`, 'error');
                updateStatus('Error testing selectors', 'error');
            }
        }

        function startTesting() {
            if (currentQuestionIndex >= questions.length) {
                currentQuestionIndex = 0;
            }
            
            log(`Starting automated testing from question ${currentQuestionIndex + 1}...`, 'info');
            updateStatus('Auto-testing in progress...', 'warning');
            
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            
            testingInterval = setInterval(sendNextQuestion, 8000); // 8 seconds between questions
            sendNextQuestion(); // Send first question immediately
        }

        function sendNextQuestion() {
            if (currentQuestionIndex >= questions.length) {
                stopTesting();
                log('All questions completed!', 'success');
                updateStatus('Testing completed!', 'success');
                return;
            }

            const question = questions[currentQuestionIndex];
            const iframe = document.getElementById('chatFrame');
            
            try {
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                const textarea = iframeDoc.querySelector('textarea.vfrc-chat-input');
                const sendButton = iframeDoc.querySelector('#vfrc-send-message');
                
                if (textarea && sendButton) {
                    // Clear existing text and type new question
                    textarea.value = '';
                    textarea.value = question;
                    
                    // Trigger input event to make sure Voiceflow recognizes the change
                    textarea.dispatchEvent(new Event('input', { bubbles: true }));
                    textarea.dispatchEvent(new Event('change', { bubbles: true }));
                    
                    // Wait a moment then click send
                    setTimeout(() => {
                        sendButton.click();
                        log(`Q${currentQuestionIndex + 1}: ${question}`, 'info');
                        currentQuestionIndex++;
                        updateStatus(`Sent question ${currentQuestionIndex}/${questions.length}`, 'warning');
                    }, 1000);
                    
                } else {
                    log('‚ùå Could not find chat elements', 'error');
                    stopTesting();
                }
                
            } catch (error) {
                log(`Error sending question: ${error.message}`, 'error');
                stopTesting();
            }
        }

        function stopTesting() {
            if (testingInterval) {
                clearInterval(testingInterval);
                testingInterval = null;
            }
            
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            
            log('Testing stopped', 'warning');
            updateStatus('Testing stopped', 'info');
        }

        // Auto-load chatbot when page loads
        window.addEventListener('load', function() {
            log('Simple Tester loaded. Click "Load Chatbot" to begin.', 'info');
        });
    </script>
</body>
</html>
