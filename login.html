<!DOCTYPE html>
<html>
<head>
  <title>Login with Okta (OIDC + PKCE)</title>
</head>
<body>
  <h2>Redirecting to Okta login...</h2>
  <script>
    async function generateCodeVerifier() {
      const array = new Uint8Array(56);
      window.crypto.getRandomValues(array);
      return btoa(String.fromCharCode(...array))
        .replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
    }
    async function generateCodeChallenge(verifier) {
      const encoder = new TextEncoder();
      const data = encoder.encode(verifier);
      const digest = await window.crypto.subtle.digest('SHA-256', data);
      const base64 = btoa(String.fromCharCode(...new Uint8Array(digest)));
      return base64.replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
    }

    async function startLogin() {
      const verifier = await generateCodeVerifier();
      const challenge = await generateCodeChallenge(verifier);
      const encodedVerifier = encodeURIComponent(verifier);

      localStorage.setItem('pkce_verifier', verifier);

      const params = new URLSearchParams({
        client_id: 'YOUR_CLIENT_ID',
        response_type: 'code',
        scope: 'openid profile email',
        redirect_uri: 'YOUR_REDIRECT_URI',
        state: encodedVerifier,
        nonce: Math.random().toString(36).substring(2),
        code_challenge_method: 'S256',
        code_challenge: challenge,
      });

      window.location.href = `https://YOUR_OKTA_DOMAIN/oauth2/default/v1/authorize?${params.toString()}`;
    }

    startLogin();
  </script>
</body>
</html>
