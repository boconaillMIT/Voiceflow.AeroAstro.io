<script>
    const QUICKBASE_CONFIG = {
        realm: 'mit.quickbase.com',
        userToken: 'b4bqn2_bkcg_0_cjj8hwibg9qrcyx9fm2qiqa5h',
        tableId: 'bvi4py32v'
    };
    
    const FIELD_IDS = {
        recordId: 3,
        questionDecoded: 26,
        status: 9,
        referredToEmail: 29,
        referredDate: 30,
        dateTime: 10
    };
    
    const WEBHOOKS = {
        submitAnswer: 'https://hook.us2.make.com/fh0skp0c9p239qlqtf5cygt28tps5efz'
    };
    
    let currentUserEmail = null;
    
    // Auto-authenticate on page load
    window.addEventListener('load', function() {
        authenticateAndLoadQuestions();
    });
    
    // Authenticate user and load their questions
    async function authenticateAndLoadQuestions() {
        try {
            // Get user data from localStorage (set during chatbot login)
            const storedData = localStorage.getItem('user_metadata');
            
            console.log('=== DEBUG: Authentication ===');
            console.log('Stored data:', storedData);
            
            if (!storedData) {
                console.log('No stored data found');
                showAuthError();
                return;
            }
            
            const userData = JSON.parse(storedData);
            console.log('Parsed user data:', userData);
            
            // Try multiple fields to get email
            currentUserEmail = userData.email || userData.kerberos + '@mit.edu' || null;
            console.log('Determined email:', currentUserEmail);
            
            if (!currentUserEmail) {
                console.log('Could not determine email');
                showAuthError();
                return;
            }
            
            // Show email in the input field (read-only)
            document.getElementById('userEmail').value = currentUserEmail;
            
            // Show debug info
            showStatus(`Logged in as: ${currentUserEmail}`, 'info');
            
            // Auto-load their questions
            await loadMyQuestions();
            
        } catch (error) {
            console.error('Authentication error:', error);
            showAuthError();
        }
    }
    
    // Show authentication error
    function showAuthError() {
        const container = document.getElementById('questionsList');
        container.innerHTML = `
            <div class="empty-state">
                <h3>ðŸ”’ Authentication Required</h3>
                <p>Please log in to the AeroAstro chatbot first to access your questions.</p>
                <br>
                <a href="https://aeroastrovfbot.netlify.app/" class="btn btn-primary">
                    Go to Chatbot Login
                </a>
                <br><br>
                <p style="font-size: 0.9em; color: #999;">
                    Debug: No user_metadata found in localStorage
                </p>
            </div>
        `;
        
        // Hide the email input section since they need to authenticate
        document.querySelector('.email-section').style.display = 'none';
    }
    
    // Load questions for this user
    async function loadMyQuestions() {
        const email = currentUserEmail || document.getElementById('userEmail').value.trim();
        
        if (!email) {
            showStatus('Unable to determine your email address', 'error');
            return;
        }
        
        showLoading(true);
        console.log('=== DEBUG: Loading Questions ===');
        console
